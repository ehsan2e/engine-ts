(()=>{"use strict";var t,e={470:(t,e,i)=>{var s={};i.r(s),i.d(s,{draw:()=>b,setup:()=>w});const n="timer.tick",o="renderable",h="game.state.undefined";var a,r,c;class l{constructor(t,e){this.state=h,this.validTransitions={},this.context=t,this.config=e;for(const t of e.transitions)this.validTransitions[l.getTransitionIdentifier(t.from,t.to)]=t;this.context.timer.attach(this.run.bind(this))}run(t){if(void 0!==this.currentState&&"update"in this.currentState)for(let e=t.intervals;e>0&&void 0!==this.currentState;e--)this.currentState.update(t);void 0!==this.currentState&&"draw"in this.currentState&&this.currentState.draw(t.lag),this.context.debug&&(void 0===this.currentState&&"draw"in this.debugState&&this.debugState.draw(t.lag),this.context.debugger.sample(t),this.context.debugger.draw(this.context.display.ctx,this.context.display.width)),this.context.mouse.flush(),this.context.keyboard.flush()}static getTransitionIdentifier(t,e){return`${t} -> ${e}`}switchState(t,e){return i=this,s=void 0,o=function*(){if(this.context.timer.stop(),!(t in this.config.states))throw new Error(`Unknown state '${t}" is requested`);if(!(l.getTransitionIdentifier(this.state,t)in this.validTransitions)&&!(l.getTransitionIdentifier(this.state,"game.state.*")in this.validTransitions))throw new Error(`Cannot transition from ${this.state} to ${t}`);this.state=t,this.currentState=this.config.states[this.state],this.context.debug&&(this.debugState=this.currentState);let i=yield this.currentState.enter(this.context,this,e);this.context.debug&&this.context.debugger.reset(),i&&("shouldResetTimer"in this.currentState?this.currentState.shouldResetTimer()?this.context.timer.start():this.context.timer.continue():this.context.timer.start()),this.context.keyboard.flush(),this.context.mouse.flush()},new((n=void 0)||(n=Promise))((function(t,e){function h(t){try{r(o.next(t))}catch(t){e(t)}}function a(t){try{r(o.throw(t))}catch(t){e(t)}}function r(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(h,a)}r((o=o.apply(i,s||[])).next())}));var i,s,n,o}}class d{constructor(){this.height=200,this.SAMPLE_LENGTH=10,this.width=400,this.canvas=E(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.reset()}draw(t,e){var i;this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="rgba(0,0,0, 0.15)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.strokeStyle="rgba(255,255,255, 0.25)",this.ctx.lineWidth=2,this.ctx.strokeRect(2,2,this.width-4,this.height-4),this.ctx.fillStyle="rgba(255,255,255, 0.5)",this.ctx.font="15px Helvetica",this.ctx.textAlign="left",this.ctx.textBaseline="top";const s=t=>25*t-20;this.ctx.fillText("Debug mode:",5,s(1)),this.ctx.fillText(`Time: ${(this.now/1e3).toFixed(1)}`,5,s(2)),this.ctx.fillText(`Frame rate [${this.samples.slice().reverse().join(", ")}]: ${null===(i=this.frameRate)||void 0===i?void 0:i.toFixed(2)}`,5,s(3)),t.drawImage(this.canvas,e-this.width-10,10)}reset(){this.currentSamples=0,this.frameRate=0,this.lastTime=void 0,this.samples=new Array(this.SAMPLE_LENGTH).fill(0)}sample(t){if(void 0===this.lastTime)this.lastTime=t.time,this.currentSamples=1;else if(t.time-this.lastTime>1e3){do{this.samples.unshift(this.currentSamples),this.lastTime+=1e3,this.currentSamples=0}while(t.time-this.lastTime>1e3);this.samples.length>=this.SAMPLE_LENGTH&&(this.samples.length=this.SAMPLE_LENGTH),this.frameRate=this.samples.reduce(((t,e)=>t+e),0)/this.samples.length,this.lastTime=t.time,this.currentSamples=1}else this.currentSamples++;this.now=t.time}}class u{constructor(){this.listeners={},this.listeners["*"]=[]}on(t,e){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(e)}emit(t,e){if(t in this.listeners)for(const i of this.listeners[t])i(e);for(const t of this.listeners["*"])t(e)}}class f{constructor(t){this.animationId=void 0,this.lag=0,this.offset=0,this.time=void 0,this.running=!1,this.config=t,this.intervalDuration=1e3/t.frameRate}enqueue(){this.isRunning()&&(this.animationId=requestAnimationFrame(this.run.bind(this)))}run(t){var e;void 0===this.time&&(this.time=0,this.offset=t),void 0!==this.stoppedAt&&(this.offset=t-this.stoppedAt,this.stoppedAt=void 0);let i=(t-(this.offset+this.time))/this.intervalDuration|0;if(i<0)throw new Error("!...");if(i>this.config.maxIntervals&&(this.offset+=(i-1)*this.intervalDuration,i=1),this.time+=i*this.intervalDuration,this.lag=t-this.time,i>0){const t={duration:this.intervalDuration,intervals:i,lag:this.lag,time:this.time};null===(e=this.config.eventEmitter)||void 0===e||e.emit(n,t)}this.enqueue()}attach(t){this.config.eventEmitter.on(n,t)}continue(){this.running=!0,this.enqueue()}isRunning(){return this.running}start(){this.reset(),this.running=!0,this.enqueue()}stop(){this.isRunning()&&(this.running=!1,this.stoppedAt=this.time,void 0!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0))}reset(){this.lag=0,this.offset=0,this.running=!1,this.stoppedAt=void 0,this.time=void 0}}!function(t){t.PRESSED="PRESSED",t.RELEASED="RELEASED"}(a||(a={})),function(t){t.LEFT="LEFT",t.RIGHT="RIGHT"}(r||(r={})),function(t){t.NEUTRAL="NEUTRAL",t.PRESSED="PRESSED",t.RELEASED="RELEASED"}(c||(c={}));class g{constructor(){this.state={}}attach(){window.addEventListener("keydown",(t=>{this.state[t.key]=a.PRESSED})),window.addEventListener("keyup",(t=>{this.state[t.key]=a.RELEASED}))}flush(){for(const[t,e]of Object.entries(this.state))e===a.RELEASED&&delete this.state[t]}isPressed(t){return t in this.state&&this.state[t]===a.PRESSED}isReleased(t){return t in this.state&&this.state[t]===a.RELEASED}read(){return this.state}}class m{draw(t){this.sketch.draw(this.sketchBook)}enter(t,e,i){return s=this,n=void 0,h=function*(){return this.context=t,this.sketch=i.sketch,this.sketchBook={SCREEN_HEIGHT:t.display.height,SCREEN_WIDTH:t.display.width,keyboard:t.keyboard,mouse:t.mouse,screen:t.display.ctx,timer:t.timer},"setup"in this.sketch&&this.sketch.setup(),"draw"in this.sketch},new((o=void 0)||(o=Promise))((function(t,e){function i(t){try{r(h.next(t))}catch(t){e(t)}}function a(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o((function(t){t(s)}))).then(i,a)}r((h=h.apply(s,n||[])).next())}));var s,n,o,h}}function E(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i}function p(t,e,i,s,n){return s+((t=Math.max(e,Math.min(t,i)))-e)*(n-s)/(i-e)}class v{constructor(t,e){this.set(t,e)}add(t,e){this.set(this.x+t,this.y+e)}set(t,e){this.x=t,this.y=e}}let y,x;function S(){y=1,x=0}function w(){S()}function b(t){y++,0===x&&t.keyboard.isPressed(" ")?(x=1,y=0):1===x&&t.keyboard.isReleased(" ")&&(x=0),t.mouse.isLeftKeyDown()&&(t.timer.stop(),t.timer.start(),S());const e=`Hello World! ${(y/60).toFixed(1)}`;t.screen.fillStyle="#DEDEDE",t.screen.fillRect(0,0,t.SCREEN_WIDTH,t.SCREEN_HEIGHT),t.screen.strokeStyle="#F00",t.screen.beginPath(),t.screen.moveTo(t.SCREEN_WIDTH/2,0),t.screen.lineTo(t.SCREEN_WIDTH/2,t.SCREEN_HEIGHT),t.screen.moveTo(0,t.SCREEN_HEIGHT/2),t.screen.lineTo(t.SCREEN_WIDTH,t.SCREEN_HEIGHT/2),t.screen.stroke(),t.screen.font="45px Helvetica",t.screen.textAlign="center",t.screen.textBaseline="middle",t.screen.fillStyle="#009",t.screen.fillText(e,t.SCREEN_WIDTH/2-1,t.SCREEN_HEIGHT/2-1),t.screen.fillStyle="#00F",t.screen.fillText(e,t.SCREEN_WIDTH/2,t.SCREEN_HEIGHT/2)}class R{constructor(t){this.levelFactory=t}draw(t){var e;null===(e=this.level)||void 0===e||e.draw(t)}enter(t,e,i){return s=this,n=void 0,h=function*(){return this.level=yield this.levelFactory.load(i.level,t,e),!0},new((o=void 0)||(o=Promise))((function(t,e){function i(t){try{r(h.next(t))}catch(t){e(t)}}function a(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o((function(t){t(s)}))).then(i,a)}r((h=h.apply(s,n||[])).next())}));var s,n,o,h}shouldResetTimer(){return!("shouldResetTimer"in this.level)||this.level.shouldResetTimer()}update(t){var e;null===(e=this.level)||void 0===e||e.update(t.duration)}}class T{constructor(t,e="renderable"){this.entityManager=t,this.tag=e}render(t){this.entityManager.forEach((e=>{const i=e.renderInfo();t.drawImage(i.buffer,i.position.x,i.position.y)}),this.tag)}}const L="game play";class k{constructor(t,e="#F00",i="#FFF"){this.acceleration=new v(3e-4,3e-4),this.age=0,this.boost=new v(0,0),this.boostX=3e-4,this.boostXL=0,this.boostXR=0,this.dragSamples=[],this.dragging=!1,this.height=96,this.position=new v(200,50),this.velocity=new v(.3,0),this.width=64,this.id=t,this.background=e,this.foreground=i;const s=E(this.width,this.height);this.ctx=s.getContext("2d"),this.renderInformation={buffer:s,position:this.position}}boostLeft(t){this.boostXL=t?this.boostX:0,this.boost.x=this.boostXR-this.boostXL}boostRight(t){this.boostXR=t?this.boostX:0}boostUp(t){this.boost.y=t?-5e-4:0}navigate(t,e){if(t.isPressed("ArrowUp")?this.boostUp(!0):t.isReleased("ArrowUp")&&this.boostUp(!1),t.isPressed("ArrowLeft")?this.boostLeft(!0):t.isReleased("ArrowLeft")&&this.boostLeft(!1),t.isPressed("ArrowRight")?this.boostRight(!0):t.isReleased("ArrowRight")&&this.boostRight(!1),e.isLeftKeyDown()){const t=e.getPosition();this.position.set(t.x,t.y),this.dragging=!0}else if(e.isLeftKeyReleased()){this.dragging=!1;const t=e.getPosition();this.position.set(t.x,t.y)}}renderInfo(){return this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle=this.foreground,this.ctx.font="20px Helvetica",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(`${this.id}`,this.width/2,this.height/2-25),this.ctx.fillText((this.age/1e3).toFixed(1).toString(),this.width/2,this.height/2+10),this.renderInformation}update(t){if(this.age+=t,this.dragging)this.dragSamples.unshift(new v(this.position.x,this.position.y)),this.dragSamples.length=3,this.velocity.set(0,0);else{const e=this.dragSamples.length;e>1?(this.velocity.set(p(this.dragSamples[0].x-this.dragSamples[e-1].x,-105,105,-45,45)/(t*(e-1)),p(this.dragSamples[0].y-this.dragSamples[e-1].y,-105,105,-45,45)/(t*(e-1))),this.dragSamples.length=0):1===e?this.dragSamples.length=0:(this.boost.x=this.boostXR-this.boostXL,this.velocity.add((this.acceleration.x+this.boost.x)*t,(this.acceleration.y+this.boost.y)*t)),this.position.add(this.velocity.x*t,this.velocity.y*t),this.position.x<5&&(this.position.x=5),this.position.y<5&&(this.position.y=5)}}static make(t){return t%2==0?new k(t,"#0F0","#050"):new k(t,"#F00","#500")}}const D="dynamic";class A{constructor(t){this.config=t}draw(t){this.config.compositor.draw(this.config.context.display.ctx,this.config.context.display.width,this.config.context.display.height,t)}loadScheduler(){this.update=t=>{this.config.scheduler.update(t),this.config.entityManager.forEach((e=>e.update(t)),D)};const t=0|Number(this.config.name),e=Math.max(1e3-25*t,20);for(let i=0;i<t;i++){const t="player "+i;0===i?this.config.entityManager.add(t,k.make(i),[o,D]):this.config.scheduler.schedule(e*i,(()=>this.config.entityManager.add(t,k.make(i),[o,D]))),this.config.scheduler.schedule(2500+e*i,(()=>this.config.entityManager.remove(t)))}this.config.scheduler.schedule(2500+e*(t-1),(()=>{const e={level:`${t+1}`};this.config.stateMachine.switchState(L,e)}))}loadNavigation(){const t=k.make(1);this.config.entityManager.add("player",t,[o,D]),this.update=e=>{t.navigate(this.config.context.keyboard,this.config.context.mouse),t.update(e)}}load(){return t=this,e=void 0,s=function*(){this.loadNavigation(),this.config.compositor.addLayer((t=>{const e=t.getContext("2d");return e.fillStyle="#FFF",e.font="30px Helvetica",e.fillText(`Level: ${this.config.name}`,10,t.height/2),e.textBaseline="middle",e=>{e.drawImage(t,0,0)}})(E(200,100)));const t=new T(this.config.entityManager);this.config.compositor.addLayer(t.render.bind(t),0)},new((i=void 0)||(i=Promise))((function(n,o){function h(t){try{r(s.next(t))}catch(t){o(t)}}function a(t){try{r(s.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(h,a)}r((s=s.apply(t,e||[])).next())}));var t,e,i,s}update(t){throw Error(`What the ...! ${t}`)}}class P{constructor(){this.layers=[]}addLayer(t,e=0){this.layers.push({layer:t,depth:e}),this.layers.sort(((t,e)=>t.depth-e.depth))}draw(t,e,i,s){t.clearRect(0,0,e,i),this.layers.forEach((e=>{e.layer(t,s)}))}}class M{constructor(){this.entities={},this.taggedEntities={}}add(t,e,i=[]){this.entities[t]=e;for(const s of i)s in this.taggedEntities||(this.taggedEntities[s]={}),this.taggedEntities[s][t]=e}forEach(t,e){if(void 0===e)for(const e of Object.values(this.entities))t(e);else if(e in this.taggedEntities)for(const i of Object.values(this.taggedEntities[e]))t(i)}remove(t){delete this.entities[t];for(const e of Object.values(this.taggedEntities))delete e[t]}}class H{constructor(){this.tasks=[],this.time=0}reset(){this.tasks=[],this.time=0}update(t){this.time+=t;const e=this.tasks.length;if(e>0){let t=0;for(;t<e;){const e=this.tasks[t];if(e.time>this.time)break;e.task(),t++}t>0&&this.tasks.splice(0,t)}}schedule(t,e){this.tasks.push({time:t,task:e}),this.tasks.sort(((t,e)=>t.time-e.time))}}class I{load(t,e,i){return s=this,n=void 0,h=function*(){const s=new P,n=new M,o=new H,h=new A({compositor:s,context:e,entityManager:n,name:t,scheduler:o,stateMachine:i});return yield h.load(),h},new((o=void 0)||(o=Promise))((function(t,e){function i(t){try{r(h.next(t))}catch(t){e(t)}}function a(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o((function(t){t(s)}))).then(i,a)}r((h=h.apply(s,n||[])).next())}));var s,n,o,h}}const K=document.querySelector("canvas");K.width=1360,K.height=765;const N={ctx:K.getContext("2d"),width:1360,height:765};let C=!1;C=!1;const _=new class{constructor(){this.leftKey=c.NEUTRAL,this.rightKey=c.NEUTRAL,this.position=new v(0,0)}attach(t){t.addEventListener("mousedown",(e=>{0===e.button?this.leftKey=c.PRESSED:2===e.button&&(this.rightKey=c.PRESSED),this.position.set(Math.max(0,Math.min(e.offsetX,t.width)),Math.max(0,Math.min(e.offsetY,t.height)))})),t.addEventListener("mouseup",(e=>{0===e.button?this.leftKey=c.RELEASED:2===e.button&&(this.rightKey=c.RELEASED),this.position.set(Math.max(0,Math.min(e.offsetX,t.width)),Math.max(0,Math.min(e.offsetY,t.height)))})),window.addEventListener("mouseup",(t=>{0===t.button?this.leftKey===c.PRESSED&&(this.leftKey=c.RELEASED):2===t.button&&this.rightKey===c.PRESSED&&(this.rightKey=c.RELEASED)})),t.addEventListener("mousemove",(e=>{this.position.set(Math.max(0,Math.min(e.offsetX,t.width)),Math.max(0,Math.min(e.offsetY,t.height)))})),t.addEventListener("contextmenu",(t=>(t.preventDefault(),!1)))}flush(){this.leftKey===c.RELEASED&&(this.leftKey=c.NEUTRAL),this.rightKey===c.RELEASED&&(this.rightKey=c.NEUTRAL)}getPosition(){return this.position}isLeftKeyDown(){return this.leftKey===c.PRESSED}isLeftKeyReleased(){return this.leftKey===c.RELEASED}isRightKeyDown(){return this.rightKey===c.PRESSED}isRightKeyReleased(){return this.rightKey===c.RELEASED}read(){return{left:this.leftKey,position:this.position,right:this.rightKey}}};_.attach(K);const F=function(t,e,i,s=!1,n){const o=new g;return o.attach(),{debug:s,debugger:new d,display:t,keyboard:o,mouse:e,timer:new f({eventEmitter:new u,frameRate:i,maxIntervals:n})}}(N,_,60,false,80);let O=[{name:"agent",game:function(){const t={};return t["game play"]=new R(new I),{initialState:"game play",initialStatePayload:{level:"1"},stateMachineConfig:{states:t,transitions:[{from:h,to:L},{from:L,to:L}]}}}()},{name:"sketch",game:function(t){const e="SKETCH",i={sketch:t},s={};return s.SKETCH=new m,{initialState:e,initialStatePayload:i,stateMachineConfig:{states:s,transitions:[{from:h,to:e}]}}}(s)}];["load","hashchange"].forEach((function(t){window.addEventListener(t,(function(){!function(t="agent"){const e=O.find((({name:e})=>e===t)),i=void 0===e?O[0].game:e.game,s=new l(F,i.stateMachineConfig);s.switchState(i.initialState,i.initialStatePayload).catch(console.error.bind(console))}(window.location.hash.substring(1))}))}))}},i={};function s(t){var n=i[t];if(void 0!==n)return n.exports;var o=i[t]={exports:{}};return e[t](o,o.exports,s),o.exports}s.m=e,t=[],s.O=(e,i,n,o)=>{if(!i){var h=1/0;for(l=0;l<t.length;l++){for(var[i,n,o]=t[l],a=!0,r=0;r<i.length;r++)(!1&o||h>=o)&&Object.keys(s.O).every((t=>s.O[t](i[r])))?i.splice(r--,1):(a=!1,o<h&&(h=o));if(a){t.splice(l--,1);var c=n();void 0!==c&&(e=c)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[i,n,o]},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={179:0,532:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var n,o,[h,a,r]=i,c=0;if(h.some((e=>0!==t[e]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);if(r)var l=r(s)}for(e&&e(i);c<h.length;c++)o=h[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(l)},i=self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var n=s.O(void 0,[532],(()=>s(470)));n=s.O(n)})();